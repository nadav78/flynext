// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL") 
}

model User {
  id               Int                @id @unique @default(autoincrement())
  password         String
  first_name       String?
  last_name        String?
  email            String?            @unique
  phone_number     String?
  Hotel            Hotel[]
  HotelReservation HotelReservation[]
  Notification     Notification[]
  UserPreference   UserPreference[]
  TripItinerary    TripItinerary[]
  PaymentSession   PaymentSession[]
  tokens           Token[]
  profileImage     String?
}

model Token {
  id        Int      @id @default(autoincrement())
  token     String   @unique
  type      String
  expiresAt DateTime
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
}

model UserPreference {
  id         Int    @id @unique @default(autoincrement())
  user       User   @relation(fields: [userId], references: [id])
  userId     Int    @unique
  theme_mode String @default("light") // light or dark
  // Other preferences as needed
}

model Notification {
  id            Int              @id @unique @default(autoincrement())
  user          User             @relation(fields: [userId], references: [id])
  reservation   HotelReservation @relation(fields: [reservationId], references: [id])
  reservationId Int
  userId        Int
  message       String
  created_at    DateTime         @default(now())
  is_read       Boolean          @default(false)
  type          NotificationType // booking, cancellation, etc.
}

enum NotificationType {
  BOOKING
  CANCELLATION
}

model Hotel {
  id               Int                @id @unique @default(autoincrement())
  owner            User               @relation(fields: [ownerId], references: [id])
  name             String
  address          String?
  Location         Location           @relation(fields: [locationId], references: [id])
  locationId       Int
  star_rating      Int?
  ownerId          Int
  description      String?
  logo             String?
  website          String?
  contact_email    String?
  contact_phone    String?
  amenities        String? // JSON string of hotel amenities
  gallery_count    Int                @default(0)
  HotelRoomType    HotelRoomType[]
  HotelReservation HotelReservation[]
}

model HotelRoomType {
  id               Int                @id @unique @default(autoincrement())
  hotel            Hotel              @relation(fields: [hotelId], references: [id])
  hotelId          Int
  name             String
  price_per_night  Decimal?
  amenities        String?
  room_count       Int
  gallery_count    Int                @default(0)
  HotelReservation HotelReservation[]
}

model HotelReservation {
  id              Int            @id @unique @default(autoincrement())
  hotel           Hotel          @relation(fields: [hotelId], references: [id])
  roomType        HotelRoomType  @relation(fields: [hotelRoomTypeId], references: [id])
  reserver        User           @relation(fields: [userId], references: [id])
  TripItinerary   TripItinerary? @relation(fields: [tripItineraryId], references: [id])
  check_in_time   DateTime
  check_out_time  DateTime
  is_cancelled    Boolean        @default(false)
  is_paid         Boolean        @default(false)
  hotelId         Int
  hotelRoomTypeId Int
  userId          Int
  tripItineraryId Int?
  Notification    Notification[]
}

model TripItinerary {
  id                    Int                @id @unique @default(autoincrement())
  user                  User               @relation(fields: [userId], references: [id])
  userId                Int
  afs_booking_reference String?
  afs_ticket_number     String?
  created_at            DateTime           @default(now())
  total_price           Decimal?
  invoice_url           String? // For storing PDF invoice links
  HotelReservation      HotelReservation[]
}

model PaymentSession {
  id           Int      @id @unique @default(autoincrement())
  user         User     @relation(fields: [userId], references: [id])
  userId       Int
  session_data String // JSON string for temporary payment info
  created_at   DateTime @default(now())
  expires_at   DateTime
}

model Location {
  id      Int       @id @unique @default(autoincrement())
  city    String
  country String
  Hotel   Hotel[]
  Airport Airport[]

  @@unique([city, country], name: "unique_location")
}

model Airport {
  id         Int      @id @unique @default(autoincrement())
  afs_id     String
  code       String
  name       String
  Location   Location @relation(fields: [locationId], references: [id])
  locationId Int
}

generator erd {
  provider = "prisma-erd-generator"
}
